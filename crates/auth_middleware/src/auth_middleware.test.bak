    Finished `test` profile [unoptimized + debuginfo] target(s) in 1.63s
     Running unittests src/lib.rs (/Users/amir36/Documents/workspace/src/github.com/BodhiSearch/BodhiApp/target/debug/deps/auth_middleware-24ed6a62430dbeb6)

running 35 tests
test auth_middleware::tests::test_auth_middleware_redirects_to_setup_for_app_status_setup_or_missing::case_2_authz_missing ... ok
test auth_middleware::tests::test_auth_middleware_redirects_to_setup_for_app_status_setup_or_missing::case_1_authz_setup ... ok
test auth_middleware::tests::test_auth_middleware_skips_if_app_status_ready_and_authz_false::case_1 ... ok
test auth_middleware::tests::test_auth_middleware_auth_header_errors::case_2 ... FAILED
test auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_2 ... FAILED
test auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_1 ... FAILED
test auth_middleware::tests::test_auth_middleware_public_key_missing ... FAILED
test auth_middleware::tests::test_auth_middleware_kid_mismatch ... FAILED
test auth_middleware::tests::test_auth_middleware_auth_header_errors::case_1 ... FAILED
test auth_middleware::tests::test_auth_middleware_auth_header_errors::case_3 ... FAILED
test auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_1 ... FAILED
test auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_2 ... FAILED
test token_cache::tests::test_is_token_in_cache_fail ... ok
test token_cache::tests::test_store_and_get_refresh_token ... ok
test token_cache::tests::test_is_token_in_cache_success ... ok
test token_cache::tests::test_nonexistent_tokens ... ok
test token_cache::tests::test_store_and_get_access_token ... ok
test token_cache::tests::test_store_token_pair ... ok
test token_cache::tests::test_token_invalid_format ... ok
test token_cache::tests::test_token_hash_verification ... ok
test token_service::tests::test_extract_token_empty ... ok
test token_service::tests::test_extract_token_missing_header ... ok
test token_service::tests::test_extract_token_invalid_format ... ok
test utils::tests::test_app_status_or_default::case_1 ... ok
test token_service::tests::test_extract_token_valid ... ok
test utils::tests::test_app_status_or_default::case_3 ... ok
test utils::tests::test_app_status_or_default::case_2 ... ok
test utils::tests::test_app_status_or_default_not_found ... ok
test auth_middleware::tests::test_auth_middleware_skips_if_app_status_ready_and_authz_false::case_2 ... ok
test auth_middleware::tests::test_auth_middleware_token_issuer_error ... FAILED
test auth_middleware::tests::test_auth_middleware_with_valid_session_token::case_2 ... ok
test auth_middleware::tests::test_auth_middleware_with_expired_session_token_and_failed_refresh ... ok
test auth_middleware::tests::test_auth_middleware_with_valid_session_token::case_1 ... ok
test auth_middleware::tests::test_auth_middleware_with_expired_session_token::case_1 ... ok
test auth_middleware::tests::test_auth_middleware_with_expired_session_token::case_2 ... ok

failures:

---- auth_middleware::tests::test_auth_middleware_auth_header_errors::case_2 stdout ----
thread 'auth_middleware::tests::test_auth_middleware_auth_header_errors::case_2' panicked at crates/auth_middleware/src/auth_middleware.rs:397:5:
assertion `left == right` failed
  left: 400
 right: 418

---- auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_2 stdout ----
thread 'auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_2' panicked at crates/auth_middleware/src/auth_middleware.rs:580:5:
assertion `left == right` failed
  left: TestResponse { x_resource_token: Some("eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiZjViNmIxY2QtNzYwNy00ODMzLWJjZDctZjAwZDMxYzI1OWVjIiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiODUyODQ1MTMtZjQxYS00OGEzLWE3YmMtMzljOWQ5OTQ0NmUyIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiNDBjMzA1MzAtMGQxZS00N2M5LTkzMjUtMmM2MGExYzQ1NzFiIiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiIyM2ZiODdkNC00OWQyLTQyOTYtOTZmZC1mY2YzOTExNWI1YWIiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.ltMkPa5-sk3iDJA0jwilDmvpmE7w1n6GnYK2FSg5HyyBf7rX5KfUntCWSDHoEyJ7bCl4gu414XIf8-GiIQ4FESpqTkB0KAOPnRuhIX7uQSrQsCgdLKxwQ0MKLWj2J0ahWPwwPFL399ZLai8CSQTSdSytd37Ekp1ZpmgSnSTkOxtitgoiRo9HmJWzRtBZZb8GnLBDvrWj2cHiQKkkaFwircLMJDMjof7mPHp30vZpFX6OFVRvAnVG8BI3XhYaHtt-34i0nBFKjK8NFjtXGVHVvexbUo-mOqWx6z1Yix9eJ3HMo6QUamozBBhRURxUiTvkU3s8MQK4Iowm80OHWccxfQ"), authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiZjViNmIxY2QtNzYwNy00ODMzLWJjZDctZjAwZDMxYzI1OWVjIiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiODUyODQ1MTMtZjQxYS00OGEzLWE3YmMtMzljOWQ5OTQ0NmUyIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiNDBjMzA1MzAtMGQxZS00N2M5LTkzMjUtMmM2MGExYzQ1NzFiIiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiIyM2ZiODdkNC00OWQyLTQyOTYtOTZmZC1mY2YzOTExNWI1YWIiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.ltMkPa5-sk3iDJA0jwilDmvpmE7w1n6GnYK2FSg5HyyBf7rX5KfUntCWSDHoEyJ7bCl4gu414XIf8-GiIQ4FESpqTkB0KAOPnRuhIX7uQSrQsCgdLKxwQ0MKLWj2J0ahWPwwPFL399ZLai8CSQTSdSytd37Ekp1ZpmgSnSTkOxtitgoiRo9HmJWzRtBZZb8GnLBDvrWj2cHiQKkkaFwircLMJDMjof7mPHp30vZpFX6OFVRvAnVG8BI3XhYaHtt-34i0nBFKjK8NFjtXGVHVvexbUo-mOqWx6z1Yix9eJ3HMo6QUamozBBhRURxUiTvkU3s8MQK4Iowm80OHWccxfQ"), path: "/with_optional_auth" }
 right: TestResponse { x_resource_token: None, authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiZjViNmIxY2QtNzYwNy00ODMzLWJjZDctZjAwZDMxYzI1OWVjIiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiODUyODQ1MTMtZjQxYS00OGEzLWE3YmMtMzljOWQ5OTQ0NmUyIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiNDBjMzA1MzAtMGQxZS00N2M5LTkzMjUtMmM2MGExYzQ1NzFiIiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiIyM2ZiODdkNC00OWQyLTQyOTYtOTZmZC1mY2YzOTExNWI1YWIiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.ltMkPa5-sk3iDJA0jwilDmvpmE7w1n6GnYK2FSg5HyyBf7rX5KfUntCWSDHoEyJ7bCl4gu414XIf8-GiIQ4FESpqTkB0KAOPnRuhIX7uQSrQsCgdLKxwQ0MKLWj2J0ahWPwwPFL399ZLai8CSQTSdSytd37Ekp1ZpmgSnSTkOxtitgoiRo9HmJWzRtBZZb8GnLBDvrWj2cHiQKkkaFwircLMJDMjof7mPHp30vZpFX6OFVRvAnVG8BI3XhYaHtt-34i0nBFKjK8NFjtXGVHVvexbUo-mOqWx6z1Yix9eJ3HMo6QUamozBBhRURxUiTvkU3s8MQK4Iowm80OHWccxfQ"), path: "/with_optional_auth" }

---- auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_1 stdout ----
thread 'auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_1' panicked at crates/auth_middleware/src/auth_middleware.rs:639:5:
assertion `left == right` failed
  left: TestResponse { x_resource_token: Some("token-from-exchange"), authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiYTk5ZWFhZjctYWRiNS00MGUzLTg2YjgtMGU5MjlhNDk4YzgyIiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiZDgzM2NiZjQtOWNiNS00NmE5LTlmMTctMTJjMDAyZDdiM2U5IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiZTU5YTM2MTctMDU1OS00MDg2LWIxZGEtZDZlYThhMWNjOGExIiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiJhNWRlMzc5Ny0zNmMzLTQ0NzYtOTVkYi03ZWIyMGNjNWUxNDYiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.bhnr0SAWWDdi9b5hiBcZzKi891dKcBiyQ9NnlozMpREWbqO4dHM7Ap4BQrf9QX6pyemiGk9IxQu4nBR0fXeTD9J-jkXqdXDkl0lGML_roQ2XbSI-TXlh1Vsbl6RK7YjMR0LHJneDEjY49w9TyTUtQdw9i_w1vYjbJEsmzJuO3nAPonsdpZYHzk7gIVmEmVMaShusSETreqikOKO6JvDNTp-72i2d5fa300Xq5KAAyKuOrI8Fc6CDtcsVLMdUFQhWWUBlrTbez9vQp_y8sDL-x8Nvp3aXIM-BmffpSjbcpyY7sLYHbbOGa3jYSUVFhBAm85ab3ljDDhtD4FdS0R7Low"), path: "/with_auth" }
 right: TestResponse { x_resource_token: None, authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiYTk5ZWFhZjctYWRiNS00MGUzLTg2YjgtMGU5MjlhNDk4YzgyIiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiZDgzM2NiZjQtOWNiNS00NmE5LTlmMTctMTJjMDAyZDdiM2U5IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiZTU5YTM2MTctMDU1OS00MDg2LWIxZGEtZDZlYThhMWNjOGExIiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiJhNWRlMzc5Ny0zNmMzLTQ0NzYtOTVkYi03ZWIyMGNjNWUxNDYiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.bhnr0SAWWDdi9b5hiBcZzKi891dKcBiyQ9NnlozMpREWbqO4dHM7Ap4BQrf9QX6pyemiGk9IxQu4nBR0fXeTD9J-jkXqdXDkl0lGML_roQ2XbSI-TXlh1Vsbl6RK7YjMR0LHJneDEjY49w9TyTUtQdw9i_w1vYjbJEsmzJuO3nAPonsdpZYHzk7gIVmEmVMaShusSETreqikOKO6JvDNTp-72i2d5fa300Xq5KAAyKuOrI8Fc6CDtcsVLMdUFQhWWUBlrTbez9vQp_y8sDL-x8Nvp3aXIM-BmffpSjbcpyY7sLYHbbOGa3jYSUVFhBAm85ab3ljDDhtD4FdS0R7Low"), path: "/with_auth" }

---- auth_middleware::tests::test_auth_middleware_public_key_missing stdout ----
thread 'auth_middleware::tests::test_auth_middleware_public_key_missing' panicked at crates/auth_middleware/src/auth_middleware.rs:471:5:
assertion `left == right` failed
  left: 500
 right: 418

---- auth_middleware::tests::test_auth_middleware_kid_mismatch stdout ----
thread 'auth_middleware::tests::test_auth_middleware_kid_mismatch' panicked at crates/auth_middleware/src/auth_middleware.rs:434:5:
assertion `left == right` failed
  left: 401
 right: 418

---- auth_middleware::tests::test_auth_middleware_auth_header_errors::case_1 stdout ----
thread 'auth_middleware::tests::test_auth_middleware_auth_header_errors::case_1' panicked at crates/auth_middleware/src/auth_middleware.rs:397:5:
assertion `left == right` failed
  left: 401
 right: 418
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

---- auth_middleware::tests::test_auth_middleware_auth_header_errors::case_3 stdout ----
thread 'auth_middleware::tests::test_auth_middleware_auth_header_errors::case_3' panicked at crates/auth_middleware/src/auth_middleware.rs:397:5:
assertion `left == right` failed
  left: 400
 right: 418

---- auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_1 stdout ----
thread 'auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_1' panicked at crates/auth_middleware/src/auth_middleware.rs:580:5:
assertion `left == right` failed
  left: TestResponse { x_resource_token: Some("eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiNGYxM2Y1YWItNjg5OS00ZDhkLTg2YzUtNDFiMWFiYTgyOGU3IiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiNjg0OTZhZTUtMWY2YS00Njg2LWJkY2ItZWNmNTkyYjMyYTIxIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiYmNhOTE4ZDMtOGQ2Yy00ODAyLTk1MDMtZWM3OWYyOWE2NDg3IiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiI0YzRjN2ExOS0wNmJjLTQwNzAtOWQ0Ny0wNGM5YjczZjc4NTUiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.jD3dDD03svNGpZ25QyUeuHcSzSWCC5sOwpcJ0QDznefPe5Ywc9TTKUgE9i989yuWQzCTsd-41WwSpcyv8vMzLTEzvxj91SPqujweoY6ZlQ56rh2xJD82ZahxwX8q16wcQfC_BZbILHS0IolsH8OnNtPYIKxlOzrBjDABq-9DoHOJf1r3aHl6bjA2tg606Xnzxsyf6yKhrHqsyM_bbs_YcprboLvkyobvm6RT_czRxBhVBHK0bC5Xx_SfS6qQNY92v7voZg-sBy4gsh6nU7Pe-R1eqZ8N96KX1x9imKi6s0d8oSDcDMEpvaHc08rH4mlI7tPAD3qwcOg8wHAu9bctiA"), authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiNGYxM2Y1YWItNjg5OS00ZDhkLTg2YzUtNDFiMWFiYTgyOGU3IiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiNjg0OTZhZTUtMWY2YS00Njg2LWJkY2ItZWNmNTkyYjMyYTIxIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiYmNhOTE4ZDMtOGQ2Yy00ODAyLTk1MDMtZWM3OWYyOWE2NDg3IiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiI0YzRjN2ExOS0wNmJjLTQwNzAtOWQ0Ny0wNGM5YjczZjc4NTUiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.jD3dDD03svNGpZ25QyUeuHcSzSWCC5sOwpcJ0QDznefPe5Ywc9TTKUgE9i989yuWQzCTsd-41WwSpcyv8vMzLTEzvxj91SPqujweoY6ZlQ56rh2xJD82ZahxwX8q16wcQfC_BZbILHS0IolsH8OnNtPYIKxlOzrBjDABq-9DoHOJf1r3aHl6bjA2tg606Xnzxsyf6yKhrHqsyM_bbs_YcprboLvkyobvm6RT_czRxBhVBHK0bC5Xx_SfS6qQNY92v7voZg-sBy4gsh6nU7Pe-R1eqZ8N96KX1x9imKi6s0d8oSDcDMEpvaHc08rH4mlI7tPAD3qwcOg8wHAu9bctiA"), path: "/with_auth" }
 right: TestResponse { x_resource_token: None, authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiNGYxM2Y1YWItNjg5OS00ZDhkLTg2YzUtNDFiMWFiYTgyOGU3IiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiNjg0OTZhZTUtMWY2YS00Njg2LWJkY2ItZWNmNTkyYjMyYTIxIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiYmNhOTE4ZDMtOGQ2Yy00ODAyLTk1MDMtZWM3OWYyOWE2NDg3IiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiI0YzRjN2ExOS0wNmJjLTQwNzAtOWQ0Ny0wNGM5YjczZjc4NTUiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.jD3dDD03svNGpZ25QyUeuHcSzSWCC5sOwpcJ0QDznefPe5Ywc9TTKUgE9i989yuWQzCTsd-41WwSpcyv8vMzLTEzvxj91SPqujweoY6ZlQ56rh2xJD82ZahxwX8q16wcQfC_BZbILHS0IolsH8OnNtPYIKxlOzrBjDABq-9DoHOJf1r3aHl6bjA2tg606Xnzxsyf6yKhrHqsyM_bbs_YcprboLvkyobvm6RT_czRxBhVBHK0bC5Xx_SfS6qQNY92v7voZg-sBy4gsh6nU7Pe-R1eqZ8N96KX1x9imKi6s0d8oSDcDMEpvaHc08rH4mlI7tPAD3qwcOg8wHAu9bctiA"), path: "/with_auth" }

---- auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_2 stdout ----
thread 'auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_2' panicked at crates/auth_middleware/src/auth_middleware.rs:639:5:
assertion `left == right` failed
  left: TestResponse { x_resource_token: Some("token-from-exchange"), authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiMmZlNjM3ZDItOTI4Mi00MDhjLTkwOTgtZDY5M2Q4Y2JmYjYwIiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiYjBlZGVjZTItNTI1YS00OWNiLTk2ZjAtODgxNTFlMDIzYzk5IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiNzQ4Y2Y5MTUtNTlmOS00YjkyLWFhNzctNTU4ZTJhMzk5NzQ3IiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiIzYzMxZGVlMC1jMDFhLTQyOGEtOWM1OS02NjMyN2NhMGI0Y2IiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.0Ws03uV_PTCyGDQIiJsElWHn59S04WkHL3u_bFK41uvop_VqtSY5odYHP_DxDnHxxH6xaVMRopYxx-L9b9k2QMKdHbjIZr_gkfvXd-CuOmpr9b31qSm57f9l4vjnlYc_iejjf-DqkvrYM3fT13WgTgwJ8qpakmdKEf66gRW-aSXjH0OwCpyrk1STnOezDByqgXerLpWNMuyL6W2pTTpHpfsw5LHXLq7ryGk_d0EFhdYCHiZYr4WKJRsIPa38E8xwImGhMyeufhW05CrjqsLy8lybr0awI4qQHPVAkKU9pwv4KUHgb5W0nnKtjN2tWefGjc4HhjTfTuQPro8d5C2sfA"), path: "/with_optional_auth" }
 right: TestResponse { x_resource_token: None, authorization_header: Some("Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InRlc3Qta2lkIn0.eyJleHAiOjE3MzY4MzQ4MDcsImlhdCI6MTczNjgzMTIwNywianRpIjoiMmZlNjM3ZDItOTI4Mi00MDhjLTkwOTgtZDY5M2Q4Y2JmYjYwIiwiaXNzIjoiaHR0cHM6Ly9pZC5teWRvbWFpbi5jb20vcmVhbG1zL215YXBwIiwic3ViIjoiYjBlZGVjZTItNTI1YS00OWNiLTk2ZjAtODgxNTFlMDIzYzk5IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoidGVzdC1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiNzQ4Y2Y5MTUtNTlmOS00YjkyLWFhNzctNTU4ZTJhMzk5NzQ3IiwicmVzb3VyY2VfYWNjZXNzIjp7InRlc3QtY2xpZW50Ijp7InJvbGVzIjpbInJlc291cmNlX21hbmFnZXIiLCJyZXNvdXJjZV9wb3dlcl91c2VyIiwicmVzb3VyY2VfdXNlciIsInJlc291cmNlX2FkbWluIl19fSwic2NvcGUiOiJvcGVuaWQgc2NvcGVfdXNlciBwcm9maWxlIGVtYWlsIHNjb3BlX3Bvd2VyX3VzZXIiLCJzaWQiOiIzYzMxZGVlMC1jMDFhLTQyOGEtOWM1OS02NjMyN2NhMGI0Y2IiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgVXNlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyQGVtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0dXNlckBlbWFpbC5jb20ifQ.0Ws03uV_PTCyGDQIiJsElWHn59S04WkHL3u_bFK41uvop_VqtSY5odYHP_DxDnHxxH6xaVMRopYxx-L9b9k2QMKdHbjIZr_gkfvXd-CuOmpr9b31qSm57f9l4vjnlYc_iejjf-DqkvrYM3fT13WgTgwJ8qpakmdKEf66gRW-aSXjH0OwCpyrk1STnOezDByqgXerLpWNMuyL6W2pTTpHpfsw5LHXLq7ryGk_d0EFhdYCHiZYr4WKJRsIPa38E8xwImGhMyeufhW05CrjqsLy8lybr0awI4qQHPVAkKU9pwv4KUHgb5W0nnKtjN2tWefGjc4HhjTfTuQPro8d5C2sfA"), path: "/with_optional_auth" }

---- auth_middleware::tests::test_auth_middleware_token_issuer_error stdout ----
thread 'auth_middleware::tests::test_auth_middleware_token_issuer_error' panicked at crates/auth_middleware/src/auth_middleware.rs:520:5:
assertion `left == right` failed
  left: 401
 right: 418


failures:
    auth_middleware::tests::test_auth_middleware_auth_header_errors::case_1
    auth_middleware::tests::test_auth_middleware_auth_header_errors::case_2
    auth_middleware::tests::test_auth_middleware_auth_header_errors::case_3
    auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_1
    auth_middleware::tests::test_auth_middleware_exchange_if_exchange_token_not_in_cache::case_2
    auth_middleware::tests::test_auth_middleware_kid_mismatch
    auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_1
    auth_middleware::tests::test_auth_middleware_no_exchange_if_present_in_cache::case_2
    auth_middleware::tests::test_auth_middleware_public_key_missing
    auth_middleware::tests::test_auth_middleware_token_issuer_error

test result: FAILED. 25 passed; 10 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.04s

error: test failed, to rerun pass `--lib`